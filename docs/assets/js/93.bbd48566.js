(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{477:function(t,s,a){"use strict";a.r(s);var e=a(10),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"docker实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker实践"}},[t._v("#")]),t._v(" Docker实践")]),t._v(" "),s("h2",{attrs:{id:"开始使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始使用"}},[t._v("#")]),t._v(" 开始使用")]),t._v(" "),s("h3",{attrs:{id:"开启docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启docker"}},[t._v("#")]),t._v(" 开启docker")]),t._v(" "),s("p",[t._v("执行 "),s("code",[t._v("docker run -dp 80:80 docker/getting-started")]),t._v(" 运行一个容器")]),t._v(" "),s("h3",{attrs:{id:"docker-面板"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-面板"}},[t._v("#")]),t._v(" Docker 面板")]),t._v(" "),s("p",[t._v("可视化Docker管理，打开该面板即可看到我们刚启动的容器")]),t._v(" "),s("h3",{attrs:{id:"什么是容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是容器"}},[t._v("#")]),t._v(" 什么是容器")]),t._v(" "),s("p",[t._v("容器只是计算机上的另一个进程，已与主机上的所有其他进程隔离。这种隔离利用了Linux上已有很长时间的内核名称空间和cgroup。")]),t._v(" "),s("h3",{attrs:{id:"什么是容器镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是容器镜像"}},[t._v("#")]),t._v(" 什么是容器镜像")]),t._v(" "),s("p",[t._v("运行容器时，它使用隔离的文件系统。此自定义文件系统由容器映像提供。由于映像包含容器的文件系统，\n因此它必须包含运行应用程序所需的所有内容-所有依赖项，配置，脚本，二进制文件等。\n该映像还包含容器的其他配置，例如环境变量，要运行的默认命令和其他元数据。")]),t._v(" "),s("h2",{attrs:{id:"我们的应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#我们的应用"}},[t._v("#")]),t._v(" 我们的应用")]),t._v(" "),s("h3",{attrs:{id:"获取-app源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取-app源码"}},[t._v("#")]),t._v(" 获取 App源码")]),t._v(" "),s("p",[s("a",{attrs:{href:"http://localhost/assets/app.zip",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击下载"),s("OutboundLink")],1),t._v("，下载完成后解压并打开")]),t._v(" "),s("h3",{attrs:{id:"构建app-容器镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建app-容器镜像"}},[t._v("#")]),t._v(" 构建APP 容器镜像")]),t._v(" "),s("p",[t._v("在上一步获取的源码的"),s("code",[t._v("app")]),t._v("目录里，新建 "),s("code",[t._v("Dockerfile")]),t._v("文件，输入下面内容")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("node")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("alpine\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WORKDIR")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COPY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" yarn install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("production\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CMD")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src/index.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("切换到"),s("code",[t._v("app")]),t._v("目录下 ，输入下面命令开始构建镜像")]),t._v(" "),s("p",[s("code",[t._v("docker build -t getting-started .")])]),t._v(" "),s("p",[s("code",[t._v("-t")]),t._v(" 给镜像打上标签，"),s("code",[t._v(".")]),t._v(" 符号，表示去当前目录找Dockerfile")]),t._v(" "),s("h3",{attrs:{id:"开启一个app容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启一个app容器"}},[t._v("#")]),t._v(" 开启一个App容器")]),t._v(" "),s("p",[t._v("执行下面命名开启一个容器，用我们刚刚打的镜像"),s("code",[t._v("getting-started")])]),t._v(" "),s("p",[s("code",[t._v("docker run -dp 3000:3000 getting-started")])]),t._v(" "),s("ol",[s("li",[t._v("-d, 在后台运行 detached")]),t._v(" "),s("li",[t._v("-p 3000:3000 在主机的端口3000到容器的端口3000之间创建映射。")])]),t._v(" "),s("p",[t._v("当控制台成功输出容器id的时候，打开浏览器http://localhost:3000/,就可以看到我们的应用。")]),t._v(" "),s("h2",{attrs:{id:"更新容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新容器"}},[t._v("#")]),t._v(" 更新容器")]),t._v(" "),s("p",[t._v("需要我们的应用在没有数据的时候提示 "),s("code",[t._v("You have no todo items yet! Add one above!")])]),t._v(" "),s("h3",{attrs:{id:"更新代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新代码"}},[t._v("#")]),t._v(" 更新代码")]),t._v(" "),s("ol",[s("li",[t._v("把 "),s("code",[t._v("src/static/js/app.js")]),t._v(" 的56行 改为 "),s("code",[t._v('<p className="text-center">No items yet! Add one above!</p>')])]),t._v(" "),s("li",[t._v("重新构建镜像，"),s("code",[t._v("docker build -t getting-started .")])]),t._v(" "),s("li",[t._v("启动新容器,"),s("code",[t._v("docker run -dp 3000:3000 getting-started")]),t._v("，此时发现报错")])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("docker")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Error response from daemon"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" driver failed programming external connectivity on endpoint "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("heuristic_greider")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cea4c33d11e0f8f1ca148c145dd24b986fcfdaacf9e03957e58072522ee4bfbb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Bind "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" port is already allocated"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"替换我们的旧容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#替换我们的旧容器"}},[t._v("#")]),t._v(" 替换我们的旧容器")]),t._v(" "),s("p",[t._v("移除一个容器，需要先把他停止，一旦容器被停止了，他就可以被移除了。有两种移除方式：")]),t._v(" "),s("ol",[s("li",[t._v("使用Docker CLI 移除")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("docker ps")]),t._v(" 获取容器id")]),t._v(" "),s("li",[s("code",[t._v("docker stop <the-container-id>")]),t._v(" 停止容器")]),t._v(" "),s("li",[s("code",[t._v("docker rm <the-container-id>")]),t._v(" 移除容器")]),t._v(" "),s("li",[s("code",[t._v("docker rm -f <the-container-id>")]),t._v(" 不需要停止，强制删除")])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("使用Docker可视化工具删除")])]),t._v(" "),s("h3",{attrs:{id:"新建容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建容器"}},[t._v("#")]),t._v(" 新建容器")]),t._v(" "),s("p",[t._v("删除我们的旧容器后，执行 "),s("code",[t._v("docker run -dp 3000:3000 getting-started")]),t._v("新建容器，刷新 http://localhost:3000/")]),t._v(" "),s("h2",{attrs:{id:"分享容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分享容器"}},[t._v("#")]),t._v(" 分享容器")]),t._v(" "),s("p",[t._v("要共享容器，需要使用"),s("code",[t._v("Docker registry")]),t._v(",默认使用的是"),s("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v(" Docker Hub "),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"创建一个仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建一个仓库"}},[t._v("#")]),t._v(" 创建一个仓库")]),t._v(" "),s("ol",[s("li",[t._v("登录 Docker Hub")]),t._v(" "),s("li",[t._v("点击Create Repository 按钮")]),t._v(" "),s("li",[t._v("输入getting-started-xxx，比如我输入了 getting-started-czp")]),t._v(" "),s("li",[t._v("点击Create")])]),t._v(" "),s("h3",{attrs:{id:"推送镜像到远程仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像到远程仓库"}},[t._v("#")]),t._v(" 推送镜像到远程仓库")]),t._v(" "),s("p",[t._v("没有tag")]),t._v(" "),s("ol",[s("li",[t._v("docker login -u YOUR-USER-NAME. 登录Docker Hub")]),t._v(" "),s("li",[t._v("docker tag getting-started YOUR-USER-NAME/getting-started-czp. 【docker tag 本地镜像源 远程镜像仓库】。 远程没有的时候会自动创建")]),t._v(" "),s("li",[t._v("docker push YOUR-USER-NAME/getting-started-czp")])]),t._v(" "),s("p",[t._v("需要tag")]),t._v(" "),s("ol",[s("li",[t._v("docker login -u YOUR-USER-NAME. 登录Docker Hub")]),t._v(" "),s("li",[t._v("docker tag getting-started YOUR-USER-NAME/getting-started-czp:test.")]),t._v(" "),s("li",[t._v("docker push YOUR-USER-NAME/getting-started-czp:tset")])]),t._v(" "),s("h3",{attrs:{id:"测试我们的镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试我们的镜像"}},[t._v("#")]),t._v(" 测试我们的镜像")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://labs.play-with-docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击打开测试地址"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("使用 Docker Hub 账户登录")]),t._v(" "),s("li",[t._v("点击 ADD NEW INSTANCE")]),t._v(" "),s("li",[t._v("docker run -dp 3000:3000 YOUR-USER-NAME/getting-started-czp")]),t._v(" "),s("li",[t._v("点击 3000端口号，就会打开刚启动的Docker服务。")])]),t._v(" "),s("h2",{attrs:{id:"数据持久化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据持久化"}},[t._v("#")]),t._v(" 数据持久化")]),t._v(" "),s("h3",{attrs:{id:"容器的文件系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器的文件系统"}},[t._v("#")]),t._v(" 容器的文件系统")]),t._v(" "),s("p",[t._v("当容器运行的时候，它使用镜像中的各个层作为其文件系统。每个容器还拥有自己的“暂存空间”以创建/更新/删除文件。\n即使使用相同的镜像，也不会在其他容器中看到任何更改。")]),t._v(" "),s("h4",{attrs:{id:"简单案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单案例"}},[t._v("#")]),t._v(" 简单案例")]),t._v(" "),s("ol",[s("li",[t._v("执行 "),s("code",[t._v('docker run -d ubuntu bash -c "shuf -i 1-10000 -n 1 -o /data.txt && tail -f /dev/null"')])])]),t._v(" "),s("p",[s("code",[t._v("shuf -i 1-10000 -n 1 -o /data.txt")]),t._v(" 输出一个 1-10000的随机数到 data.txt")]),t._v(" "),s("p",[s("code",[t._v("tail -f /dev/null")]),t._v(" 这个命令是持续输出，保持容器运行")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("在 Docker 可视化工具中打开刚刚启动的ubuntu。执行"),s("code",[t._v("cat /data.txt")]),t._v("， 可以看到"),s("code",[t._v("data.txt")]),t._v("的数据")])]),t._v(" "),s("p",[t._v("或者直接执行 "),s("code",[t._v("docker exec <container-id> cat /data.txt")]),t._v("，也可以看到数据")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("我们开启一个新的容器 "),s("code",[t._v("docker run -it ubuntu ls /")]),t._v("并查看文件系统，此时未发现"),s("code",[t._v("data.txt")])])]),t._v(" "),s("li",[s("p",[t._v("移除第一个ubuntu 容器 ，"),s("code",[t._v("docker rm -f 32031d768702")])])])]),t._v(" "),s("h3",{attrs:{id:"容器卷-container-volumes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器卷-container-volumes"}},[t._v("#")]),t._v(" 容器卷 Container Volumes")]),t._v(" "),s("ol",[s("li",[t._v("创建容器卷"),s("code",[t._v("docker volume create todo-db")])]),t._v(" "),s("li",[t._v("移除存在的todo-list容器 "),s("code",[t._v("docker rm -f <id>")])]),t._v(" "),s("li",[t._v("开启新容器，并加入"),s("code",[t._v("-v")]),t._v(" 参数， "),s("code",[t._v("docker run -dp 3000:3000 -v todo-db:/etc/todos getting-started")])]),t._v(" "),s("li",[t._v("打开"),s("code",[t._v("http://localhost:3000/")]),t._v("新增几个todo-item")]),t._v(" "),s("li",[t._v("使用 "),s("code",[t._v("docker ps")]),t._v("获取所有容器id，使用 "),s("code",[t._v("docker rm -f <id>")]),t._v("删除容器")]),t._v(" "),s("li",[t._v("使用第3条命令再次执行")])]),t._v(" "),s("h3",{attrs:{id:"深入探讨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#深入探讨"}},[t._v("#")]),t._v(" 深入探讨")]),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("docker volume inspect todo-db")]),t._v(" 查看Docker实际上将数据存储在哪里")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"CreatedAt"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-02-02T08:28:44Z"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"Driver"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"Labels"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"Mountpoint"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes/todo-db/_data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 磁盘上存储数据的实际位置\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"Name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"todo-db"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"Options"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"Scope"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("h2",{attrs:{id:"使用绑定安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用绑定安装"}},[t._v("#")]),t._v(" 使用绑定安装")]),t._v(" "),s("p",[t._v("使用绑定安装，我们可以控制主机上的确切安装点。\n我们可以使用它来保留数据，但通常用于向容器中提供其他数据。\n在处理应用程序时，我们可以使用绑定挂载将源代码挂载到容器中，以使其查看代码更改，响应并立即查看更改。")]),t._v(" "),s("h3",{attrs:{id:"快速卷类型比较"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速卷类型比较"}},[t._v("#")]),t._v(" 快速卷类型比较")]),t._v(" "),s("p",[t._v("绑定安装和命名卷是Docker引擎随附的两种主要卷类型。但是，可以使用其他卷驱动程序来支持其他用例（SFTP，Ceph，NetApp，S3等）")]),t._v(" "),s("h3",{attrs:{id:"开始一个开发环境下的容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始一个开发环境下的容器"}},[t._v("#")]),t._v(" 开始一个开发环境下的容器")]),t._v(" "),s("ol",[s("li",[t._v("把源码挂载在容器里")]),t._v(" "),s("li",[t._v("安装所有依赖，包括开发依赖")]),t._v(" "),s("li",[t._v("启动nodemon 检测文件改动")])]),t._v(" "),s("p",[t._v("开始配置环境")]),t._v(" "),s("ol",[s("li",[t._v("执行下列代码")])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dp "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("w "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$(pwd):/app"')]),t._v(" \\\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("node")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("alpine \\\n    sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yarn install && yarn run dev"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ul",[s("li",[t._v("-dp 3000:3000 在后台模式下运行并创建端口映射")]),t._v(" "),s("li",[t._v("-w /app 设置命令的“工作目录”或当前目录")]),t._v(" "),s("li",[t._v('-v "$(pwd):/app" 从容器中的主机将当前目录绑定挂载到/ app目录中')]),t._v(" "),s("li",[t._v("node:12-alpine 和我们Dockerfile 配置的 一样")]),t._v(" "),s("li",[t._v('sh -c "yarn install && yarn run dev" 安装开发依赖并启动服务')])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("查看docker输出日志 "),s("code",[t._v("docker logs -f --tail=10 <container-id>")])]),t._v(" "),s("li",[t._v("修改 "),s("code",[t._v("src/static/js/app.js")]),t._v("文件的 "),s("code",[t._v("{submitting ? 'Adding...' : 'Add Item'}")]),t._v(" 为"),s("code",[t._v("{submitting ? 'Adding...' : 'Add'}")])]),t._v(" "),s("li",[t._v("刷新浏览器可以看到按钮变了。")]),t._v(" "),s("li",[t._v("重新构建镜像  "),s("code",[t._v("docker build -t getting-started .")])])]),t._v(" "),s("h2",{attrs:{id:"多容器运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多容器运行"}},[t._v("#")]),t._v(" 多容器运行")]),t._v(" "),s("p",[t._v("当我们使用node + mongodb开发项目的时候，需要两个容器来跑应用。理由如下")]),t._v(" "),s("ol",[s("li",[t._v("数据隔离")]),t._v(" "),s("li",[t._v("单独的容器可让您隔离版本和更新版本")]),t._v(" "),s("li",[t._v("有可能本地开发的时候需要本地版本，服务器开发的时候需要服务器版本。")]),t._v(" "),s("li",[t._v("运行多个进程将需要一个进程管理器（容器仅启动一个进程），这增加了容器启动/关闭的复杂性")])]),t._v(" "),s("h3",{attrs:{id:"容器网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器网络"}},[t._v("#")]),t._v(" 容器网络")]),t._v(" "),s("p",[t._v("容器间通过网络进行通信，如果两个容器在同一个网络，那么他们能通信，否则不可以。")]),t._v(" "),s("h3",{attrs:{id:"开启mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启mysql"}},[t._v("#")]),t._v(" 开启MySQL")]),t._v(" "),s("ol",[s("li",[t._v("创建一个网络 "),s("code",[t._v("docker network create todo-app")])]),t._v(" "),s("li",[t._v("启动一个MySQL容器并将其附加到网络")])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("network todo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("network"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("alias mysql \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v todo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysql \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("secret \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_DATABASE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("todos \\\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mysql")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.7")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("blockquote",[s("p",[t._v("我们通过-v 连接了卷，但是我们没有通过 "),s("code",[t._v("docker volume create todo-mysql-data")]),t._v("创建卷。实际上，当我们运行命令的时候\ndocker发现我们没有"),s("code",[t._v("todo-mysql-data")]),t._v("，他会给我们创建一个，并挂载。")])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("确认下我们的数据库是否运行 "),s("code",[t._v("docker exec -it <mysql-container-id> mysql -p")])])]),t._v(" "),s("ul",[s("li",[t._v("输入密码 "),s("code",[t._v("secret")])]),t._v(" "),s("li",[t._v("登录后输入 "),s("code",[t._v("SHOW DATABASES;")])])]),t._v(" "),s("h3",{attrs:{id:"连接到mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#连接到mysql"}},[t._v("#")]),t._v(" 连接到MySQL")]),t._v(" "),s("p",[t._v("使用  "),s("a",{attrs:{href:"https://github.com/nicolaka/netshoot",target:"_blank",rel:"noopener noreferrer"}},[t._v("nicolaka/netshoot"),s("OutboundLink")],1),t._v(" 容器，这个容器有很多有用的网络工具")]),t._v(" "),s("ol",[s("li",[t._v("使用"),s("code",[t._v("nicolaka/netshoot")]),t._v("镜像开启一个新的容器，确保它连接在同一个网络\n"),s("code",[t._v("docker run -it --network todo-app nicolaka/netshoot")])]),t._v(" "),s("li",[t._v("输入"),s("code",[t._v("dig mysql")]),t._v(" ，输出")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n[1] 🐳  → dig mysql\n\n; <<>> DiG 9.14.12 <<>> mysql\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 3399\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;mysql.\t\t\t\tIN\tA\n\n;; ANSWER SECTION:\nmysql.\t\t\t600\tIN\tA\t172.18.0.2\n\n;; Query time: 2 msec\n;; SERVER: 127.0.0.11#53(127.0.0.11)\n;; WHEN: Tue Feb 02 10:27:24 UTC 2021\n;; MSG SIZE  rcvd: 44\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br")])]),s("p",[t._v("ANSWER SECTION: 下的172.18.0.2就是我们的容器通讯ip。")]),t._v(" "),s("p",[t._v("虽然mysql不是有效的主机名，但是Docker知道怎么通过主机名解析到IP。这意味着我们要连接到mysql容器，只需要知道别名就可以。")]),t._v(" "),s("h3",{attrs:{id:"把应用的数据库连接到mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#把应用的数据库连接到mysql"}},[t._v("#")]),t._v(" 把应用的数据库连接到Mysql")]),t._v(" "),s("ul",[s("li",[t._v("MYSQL_HOST - the hostname for the running MySQL server")]),t._v(" "),s("li",[t._v("MYSQL_USER - the username to use for the connection")]),t._v(" "),s("li",[t._v("MYSQL_PASSWORD - the password to use for the connection")]),t._v(" "),s("li",[t._v("MYSQL_DB - the database to use once connected")])]),t._v(" "),s("ol",[s("li",[t._v("执行下来操作")])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dp "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("w "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$(pwd):/app"')]),t._v(" \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("network todo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("app \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_HOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mysql \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_USER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("secret \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MYSQL_DB")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("todos \\\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("node")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("alpine \\\n  sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yarn install && yarn run dev"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[t._v("查看应用日志  "),s("code",[t._v("docker logs <container-id>")]),t._v("，会看到 Connected to mysql db at host mysql")])]),t._v(" "),s("li",[s("p",[t._v("打开http://localhost:3000/，新增几个todo-item")])]),t._v(" "),s("li",[s("p",[t._v("查看数据库数据 "),s("code",[t._v("docker exec -it <mysql-container-id> mysql -p todos")])])])]),t._v(" "),s("p",[t._v("输入密码后，执行 "),s("code",[t._v("select * from todo_items;")]),t._v("可以看到打印的数据")]),t._v(" "),s("h2",{attrs:{id:"容器组合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器组合"}},[t._v("#")]),t._v(" 容器组合")]),t._v(" "),s("ol",[s("li",[t._v("在app目录下新建 "),s("code",[t._v("docker-compose.yml")]),t._v("，输入下列命令")])]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.7"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("12"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('c "yarn install '),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&&")]),t._v(' yarn run dev"\n    '),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 3000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working_dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /app\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/app\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_HOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" secret\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_DB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" todos\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.7")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" todo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" secret\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_DATABASE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" todos\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("todo-mysql-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[t._v("删除我们前面启动的容器")])]),t._v(" "),s("li",[s("p",[t._v("执行 "),s("code",[t._v("docker-compose up -d")]),t._v("，控制台打印")])])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('Creating network "app_default" with the default driver\nCreating volume "app_todo-mysql-data" with default driver\nCreating app_app_1   ... done\nCreating app_mysql_1 ... done\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("执行 "),s("code",[t._v("docker-compose logs -f app")]),t._v("可以查看日志")])]),t._v(" "),s("h3",{attrs:{id:"docker面板显示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker面板显示"}},[t._v("#")]),t._v(" Docker面板显示")]),t._v(" "),s("p",[t._v("Docker面板可以看见运行的app组，这个名字默认是docker-compose.yml所在目录的项目名，展开后可以看看见")]),t._v(" "),s("p",[t._v("两个子容器，名字是以 "),s("code",[t._v("project-name>_<service-name>_<replica-number>")]),t._v("组成的。")]),t._v(" "),s("h3",{attrs:{id:"拆开组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拆开组"}},[t._v("#")]),t._v(" 拆开组")]),t._v(" "),s("p",[t._v("在app目录下执行 "),s("code",[t._v("docker-compose down")]),t._v(" ，所有容器将停止，网络被移除。\n但是volumes不会被移除，如果需要移除则加上 --volumes")]),t._v(" "),s("h2",{attrs:{id:"构建镜像的最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像的最佳实践"}},[t._v("#")]),t._v(" 构建镜像的最佳实践")]),t._v(" "),s("h3",{attrs:{id:"安全扫描"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全扫描"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://docs.docker.com/engine/scan/",target:"_blank",rel:"noopener noreferrer"}},[t._v("安全扫描"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("当构建镜像的时候使用"),s("code",[t._v("docker scan")]),t._v("命令进行漏洞检测。")]),t._v(" "),s("p",[t._v("也可以在Docker Hub的配置中设置自动扫描。")]),t._v(" "),s("h3",{attrs:{id:"镜像分层"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像分层"}},[t._v("#")]),t._v(" 镜像分层")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("可以使用 "),s("code",[t._v("docker image history <image-name>")]),t._v("查看镜像分层。使用此功能，您还可以快速查看每个分层的大小，从而帮助诊断大镜像。")])]),t._v(" "),s("li",[s("p",[t._v("使用上面命令的时候看见数据被折断了，可以使用 "),s("code",[t._v("docker image history --no-trunc getting-started")]),t._v("打印完整的输出。")])])]),t._v(" "),s("h3",{attrs:{id:"分层缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分层缓存"}},[t._v("#")]),t._v(" 分层缓存")]),t._v(" "),s("p",[t._v("图层更改后，所有下游图层也必须重新创建")])])}),[],!1,null,null,null);s.default=r.exports}}]);